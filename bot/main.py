from aiogram import Bot, Dispatcher, F, Router, types

from aiogram.enums.chat_type import ChatType

from aiogram.filters import ChatMemberUpdatedFilter
from aiogram.filters.chat_member_updated import JOIN_TRANSITION

import asyncio

import config
import filters
import handlers


bot = Bot(config.API_TOKEN)
dp = Dispatcher()


private_rt = Router()
group_rt = Router()
channel_rt = Router()

private_rt.message.filter(filters.PrivateRouterFilter)
group_rt.message.filter(filters.GroupRouterFilter)
channel_rt.message.filter(filters.ChannelRouterFilter)

private_rt.channel_post.filter(False)
group_rt.channel_post.filter(False)
channel_rt.channel_post.filter(True)

private_rt.chat_member.filter(filters.PrivateRouterFilter)
group_rt.chat_member.filter(filters.GroupRouterFilter)
channel_rt.chat_member.filter(filters.ChannelRouterFilter)

dp.include_routers(group_rt, private_rt, channel_rt)


@group_rt.chat_member(ChatMemberUpdatedFilter(member_status_changed=JOIN_TRANSITION))
async def welcome(event: types.ChatMemberUpdated):

    if event.from_user.username[-3:] != 'bot':
        await event.answer_photo(
            photo=config.WELCOME_IMAGE_LINK,
            caption=f'''üî¥–ü—Ä–∏–≤–µ—Ç, [{event.from_user.full_name}](https://t.me/{event.from_user.username})üëãüëãüëã

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç\. –£ –Ω–∞—Å —Ç—É—Ç –ø—Ä–∞–≤–∏–ª–∞, –≤—Å—ë –∫–∞–∫ –≤–µ–∑–¥–µ:

üëâ –£–≤–∞–∂–∞–π—Ç–µ –¥—Ä—É–≥–∏—Ö, –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –Ω–∏–º —Ç–∞–∫, –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–Ω–æ—Å–∏–ª–∏—Å—å –∫ –≤–∞–º

üëâ –ù–∏–∫–æ–≥–æ –Ω–µ –æ—Å–∫–æ—Ä–±–ª—è–π—Ç–µ, –Ω–µ –Ω—É–∂–Ω–æ –ø–ª–æ–¥–∏—Ç—å –∞–≥—Ä–µ—Å—Å–∏—é\. –î–∞–≤–∞–π—Ç–µ –ª—É—á—à–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –¥–æ–±—Ä–æ–µ –æ–±—â–µ–Ω–∏–µ\)

üëâ –ù–∏–∫–∞–∫–æ–π —Ä–µ–∫–ª–∞–º—ã –≤ —á–∞—Ç–µ, –ø–æ–Ω—è—Ç–Ω–æ?üòâ

üëâ –ù–µ –ø—Ä–∏—Å—ã–ª–∞–π—Ç–µ —Å—é–¥–∞ —à–æ–∫–∏—Ä—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –ø–æ—Ä–Ω–æ–≥—Ä–∞—Ñ–∏—é

üëâ –ú—ã –æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –≥—Ä—É–ø–ø—ã

‚ùóÔ∏è –ó–∞–Ω—É–¥—Å—Ç–≤–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å, –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å\)''',
        parse_mode='MarkdownV2'
    )

    else:
        bot.ban_chat_member(chat_id=config.GROUP_ID, revoke_messages=True, user_id=event.from_user.id)


async def start():
    await dp.start_polling(bot)


if __name__ == '__main__':
    asyncio.run(start())
